name: test_docker

on:
  push:
    branches: [ "623-CI-with-CML-runtimes" ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: get runtimes
      run:   git clone https://github.com/cloudera/ml-runtimes.git
    - name: build cml_3.9
      run: |  
             cd ml-runtimes
             docker build -t cml_3.9 -f 'pbj-workbench-python3.9-standard.Dockerfile' .
             
    - name: run image
      run:  docker run -i cml_3.9
                      
    - name: get project
      run:  git clone https://github.com/ONSdigital/monthly-business-survey-results.git

    - name: build
      run: |    
             cd monthly-business-survey-results
             pip install .[dev]
    - name: test
      run: pytest        
             
             
        
         
