name: test_docker

on:
  push:
    branches: [ "623-CI-with-CML-runtimes" ]
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        cml_version: [3.8, 3.9, 3.10]
    steps:
    - name: clone runtimes
      run:   git clone https://github.com/cloudera/ml-runtimes.git
    - name: buid cml_${{matix.cml_version}}
      run: |  
             cd ml-runtimes
             docker build -t cml_${{matix.cml_version}} -f 'pbj-workbench-python${{matix.cml_version}}-standard.Dockerfile' .
             
    - name: run image
      run: |              
             docker run -i cml_${{matix.cml_version}}
             git clone https://github.com/ONSdigital/monthly-business-survey-results.git
             cd monthly-business-survey-results
             pip install .[dev]
             pytest
             echo end
             exit
